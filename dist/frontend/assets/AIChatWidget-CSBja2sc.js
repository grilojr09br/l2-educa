var re=(t,n,c)=>new Promise((m,v)=>{var M=p=>{try{q(c.next(p))}catch(_){v(_)}},b=p=>{try{q(c.throw(p))}catch(_){v(_)}},q=p=>p.done?m(p.value):Promise.resolve(p.value).then(M,b);q((c=c.apply(t,n)).next())});import{r,j as e,R as Oe}from"./react-vendor-DYggY1V5.js";import{u as Re}from"./index-CC7PbPsl.js";import{S as ee,u as He}from"./page-biologyfilos-DbwxiJEI.js";import"./vendor-IcH3LwkJ.js";import"./page-terminal-aE8zRC8X.js";import"./page-analyticgeometry-DYH9OuZI.js";import"./math-components-44q-3l9c.js";import"./page-forgotpassword-B2MfD6L6.js";/* empty css                       */import"./page-verifyemail-MIX6RStA.js";const ze=t=>{if(!t||typeof t!="string")return[];const n=[],c=/\[\[([A-Z_]+):([^\]]+)\]\]/g;let m;for(;(m=c.exec(t))!==null;)n.push({type:m[1],content:m[2],fullMatch:m[0],index:m.index});return n},Ne=t=>t?t.replace(/\[\s*\[\s*([A-Z_]+)\s*:\s*([^\]]+?)\s*\]\s*\]/g,"[[$1:$2]]").replace(/\[([A-Z_]+):([^\]]+)\]/g,"[[$1:$2]]").replace(/\[\[([A-Z_]+):([^\]]+)\](?!\])/g,"[[$1:$2]]").replace(new RegExp("(?<!\\[)\\[([A-Z_]+):([^\\]]+)\\]\\]","g"),"[[$1:$2]]").replace(/\[\[([A-Z_]+):([^\]]+?)$/g,"[[$1:$2]]"):"",Ue=t=>{const n=t.split("|").map(c=>c.trim());return{label:n[0]||"Navegar",path:n[1]||"/",icon:n[2]||"arrow_forward"}},Be=t=>{const n=t.trim();for(const c in ee){const m=ee[c];if(m.topics&&Array.isArray(m.topics)){const v=m.topics.find(M=>M.id===n);if(v)return{id:n,title:v.title||v.name,path:v.path,icon:v.icon||m.icon,difficulty:v.difficulty,duration:v.duration,gradient:v.gradient||m.gradient,subjectName:m.name}}}return null},Ve=t=>{if(!t||typeof t!="string")return{valid:!1,reason:"Empty or invalid text"};const n=t.trim();if(n.length<15)return{valid:!1,reason:`Too short (${n.length} chars, minimum 15)`};if(n.length>100)return{valid:!1,reason:`Too long (${n.length} chars, maximum 100)`};if(["pergunta","texto","aqui","placeholder","..."].some(b=>n.toLowerCase()===b))return{valid:!1,reason:"Placeholder text detected"};const m=[/\bvocÃª\b/i,/\bquer\b/i,/\bdeseja\b/i,/\bgostaria\b/i,/\bpor onde vocÃª\b/i,/\bonde vocÃª\b/i];for(const b of m)if(b.test(n))return{valid:!1,reason:`Second person detected (use first person instead): "${n.match(b)[0]}"`};return[/\bquero\b/i,/\bpreciso\b/i,/\bme mostre\b/i,/\bcomo posso\b/i,/\bme explique\b/i,/\bme ajude\b/i].some(b=>b.test(n))?{valid:!0,reason:"Valid"}:{valid:!1,reason:'No first-person language detected (use "Quero", "Me mostre", "Como posso", etc.)'}},Ke=t=>{if(!t)return"";let n=t.replace(/\[\[NAVIGATE:[^\]]*\]\]/g,"").replace(/\[\[TOPIC:[^\]]*\]\]/g,"").replace(/\[\[FOLLOW_UP:[^\]]*\]\]/g,"").replace(/\[\[FORMULA:[^\]]*\]\]/g,"").replace(/\[\s*\[\s*[A-Z_]+\s*:.*?\]\s*\]/g,"").replace(/\[[A-Z_]+:.*?\]/g,"").replace(/\[\s*\]/g,"").replace(/\]\s*\]/g,"").replace(/\[\s*\[/g,"").replace(/\s+$/gm,"");return n=n.replace(/\]\s*$/gm,"").replace(/^\s*\[/gm,"").replace(/\s+\]\s+/g," ").replace(/\s+\[\s+/g," ").trim(),n},qe=({className:t="h-6 w-6"})=>e.jsx("svg",{className:t,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",style:{imageRendering:"crisp-edges"},children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9 1.5l1.25 4.5a3 3 0 002.25 2.25l4.5 1.25-4.5 1.25a3 3 0 00-2.25 2.25L9 18l-1.25-4.5a3 3 0 00-2.25-2.25L1 10l4.5-1.25a3 3 0 002.25-2.25L9 1.5zM19 3l.75 2.25a2.25 2.25 0 001.5 1.5L24 7.5l-2.75.75a2.25 2.25 0 00-1.5 1.5L19 12l-.75-2.25a2.25 2.25 0 00-1.5-1.5L14 7.5l2.75-.75a2.25 2.25 0 001.5-1.5L19 3z"})}),De=({className:t="h-5 w-5"})=>e.jsxs("svg",{className:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",xmlns:"http://www.w3.org/2000/svg",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",style:{imageRendering:"crisp-edges"},children:[e.jsx("path",{d:"M3 6h18"}),e.jsx("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6"}),e.jsx("path",{d:"M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2"}),e.jsx("path",{d:"M10 11v6"}),e.jsx("path",{d:"M14 11v6"})]}),Fe=({className:t="h-5 w-5"})=>e.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),We=({className:t="h-6 w-6"})=>e.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),be=({className:t="h-5 w-5"})=>e.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M13 7l5 5m0 0l-5 5m5-5H6"})}),ye=t=>{const n={functions:e.jsx("svg",{className:"inline-block w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79 0-1.52-.86-2.82-2.15-3.42zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z"})}),quiz:e.jsx("svg",{className:"inline-block w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"})}),book:e.jsx("svg",{className:"inline-block w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"})}),arrow_forward:e.jsx("svg",{className:"inline-block w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"})}),play_arrow:e.jsx("svg",{className:"inline-block w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M8 5v14l11-7z"})}),science:e.jsx("svg",{className:"inline-block w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M13 11.33L18 18H6l5-6.67V6h2m2-2H9v7.5L4 18v2h16v-2l-5-6.5V4z"})}),calculate:e.jsx("svg",{className:"inline-block w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5.97 4.06L14.09 6l1.41 1.41L16.91 6l1.06 1.06-1.41 1.41 1.41 1.41-1.06 1.06-1.41-1.4-1.41 1.41-1.06-1.06 1.41-1.41-1.41-1.42zm-6.78.66h5v1.5h-5v-1.5zM11.5 16h-5v-1.5h5V16zm6.5 1.25h-1.75V19h-1.5v-1.75H13v-1.5h1.75V14h1.5v1.75H18v1.5z"})}),analytics:e.jsx("svg",{className:"inline-block w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"})})};return n[t]||n.arrow_forward},Ye=(t,n)=>n?[`Me explique ${n.title||n.name} de forma simples`,"Quais sÃ£o os pontos mais importantes para o ENEM sobre este tÃ³pico?"]:t?[`Quais tÃ³picos de ${t.name} sÃ£o essenciais para o ENEM?`,`Por onde devo comeÃ§ar a estudar ${t.name}?`]:["Qual matÃ©ria devo priorizar para o ENEM?","Como organizar meu tempo de estudo de forma eficiente?"];function rs(){var je,we;const{messages:t,setMessages:n,isOpen:c,openChat:m,closeChat:v,clearCurrentChat:M,clearAllChats:b,currentContext:q,apiConfig:p,getConversation:_,isApiConfigured:D,isTransitioning:Ze,hasHistory:Je}=Re(),{navigateWithTransition:ke,currentSubject:le,currentTopic:de}=He(),[he,ue]=r.useState(""),[x,me]=r.useState(!1),[F,pe]=r.useState(!1),[se,T]=r.useState(""),[Ce,W]=r.useState(!0),[te,Y]=r.useState(!1),[Se,ge]=r.useState(null),j=r.useRef(null),O=r.useRef(0),fe=r.useRef(t.length),ae=r.useRef(!1),ve=r.useRef(!1),ne=r.useRef(p.apiKeys.map(s=>({key:s,cooldownUntil:0,invalid:!1}))),Z=r.useRef(0),Te=3900*1e3,J=60*1e3;r.useEffect(()=>{ne.current=p.apiKeys.map(s=>({key:s,cooldownUntil:0,invalid:!1}))},[p.apiKeys]);const Ee=r.useMemo(()=>Ye(le,de),[le,de]),ie=()=>{j.current&&(O.current=j.current.scrollTop),pe(!0),setTimeout(()=>{v(),pe(!1),W(!0)},300)};r.useEffect(()=>{const s=a=>{c&&!F&&(a.preventDefault(),ie(),window.history.pushState(null,"",window.location.href))};return c&&(window.history.pushState(null,"",window.location.href),window.addEventListener("popstate",s)),()=>{window.removeEventListener("popstate",s)}},[c,F]),r.useEffect(()=>{const s=window.matchMedia("(max-width: 768px)").matches;if(c&&s){const a=window.scrollY;return document.body.style.position="fixed",document.body.style.top=`-${a}px`,document.body.style.width="100%",document.body.style.overflow="hidden",()=>{document.body.style.position="",document.body.style.top="",document.body.style.width="",document.body.style.overflow="",window.scrollTo(0,a)}}},[c]),r.useEffect(()=>{c&&j.current&&O.current>0&&setTimeout(()=>{j.current&&(j.current.scrollTop=O.current)},50)},[c]),r.useEffect(()=>{var l;const s=t[t.length-1],a=x&&(s==null?void 0:s.role)==="assistant"&&((l=s==null?void 0:s.content)==null?void 0:l.includes("â–ˆ"));ve.current&&!a&&(s==null?void 0:s.role)==="assistant"&&(ge(t.length-1),setTimeout(()=>{ge(null)},1e3)),ve.current=a},[x,t]),r.useEffect(()=>{var g;if(!j.current)return;const s=t.length>fe.current,a=t[t.length-1],l=x&&((g=a==null?void 0:a.content)==null?void 0:g.includes("â–ˆ")),d=l&&(a==null?void 0:a.role)==="assistant";s&&(ae.current=!1),c&&d&&!ae.current&&(j.current.scrollTo({top:j.current.scrollHeight,behavior:"smooth"}),ae.current=!0,O.current=j.current.scrollHeight),c&&s&&!l&&(j.current.scrollTop=j.current.scrollHeight,O.current=j.current.scrollHeight),fe.current=t.length},[t,c,x]),r.useEffect(()=>{const s=t[t.length-1];if(s&&s.role==="assistant"&&typeof s.content=="string"){const l=Ne(s.content).match(/\[\[FOLLOW_UP:(.+?)\]\]/);if(l){const d=l[1].trim(),g=Ve(d);g.valid?T(d):(console.warn(`âŒ Invalid follow-up rejected: "${d}"`),console.warn(`   Reason: ${g.reason}`),T(""))}else T("")}},[t]);const Le=()=>{const s=Date.now(),a=ne.current,l=a.length;for(let d=0;d<l;d++){const g=(Z.current+d)%l,i=a[g];if(i&&!i.invalid&&!(i.cooldownUntil&&i.cooldownUntil>s))return g}return-1},R=(s,a)=>{const l=ne.current;l[s]&&(a==="invalid"&&(l[s].invalid=!0),typeof a=="number"&&(l[s].cooldownUntil=Date.now()+a))},Me=s=>{const a=Ne(s),l=ze(a);let d=Ke(a);const g=o=>o.replace(/[&<>"']/g,u=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[u]),i=o=>{let u=g(o);return u=u.replace(/```(.+?)```/g,'<code class="chat-code-block">$1</code>'),u=u.replace(/`(.+?)`/g,'<code class="chat-code-inline">$1</code>'),u=u.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),u=u.replace(/\*(.+?)\*/g,"<em>$1</em>"),u=u.replace(/\*\*/g,""),u=u.replace(new RegExp("(?<!\\S)\\*(?!\\S)","g"),""),u},C=d.split(/\n/);let f="",N=!1;const y=()=>{N&&(f+="</ul>",N=!1)};for(const o of C){const u=o.match(/^###\s+(.+)/),H=o.match(/^##\s+(.+)/),z=o.match(/^\s*[-*â€¢]\s+(.+)/);if(u)y(),f+=`<h3 class="chat-heading-3">${i(u[1])}</h3>`;else if(H)y(),f+=`<h2 class="chat-heading-2">${i(H[1])}</h2>`;else if(z)N||(f+='<ul class="chat-list">',N=!0),f+=`<li>${i(z[1])}</li>`;else{y();const U=i(o);U.trim().length?f+=`<p>${U}</p>`:f+="<br />"}}return y(),{html:f,tokens:l}},Ie=s=>!!(s==="/"||s===""||Object.values(ee).some(d=>d.path===s)||Object.values(ee).some(d=>d.topics&&d.topics.some(g=>g.path===s))),xe=(s,a="purple")=>{Ie(s)||console.warn(`âš ï¸ Invalid navigation path attempted: ${s}`),ke(s,a),ie()},$e=()=>{Y(s=>!s)},Ae=()=>{M(),Y(!1),T(""),W(!0)},Pe=()=>{window.confirm("Tem certeza que deseja limpar TODAS as conversas de todos os tÃ³picos?")&&(b(),Y(!1),T(""),W(!0))};r.useEffect(()=>{if(!te)return;const s=a=>{!a.target.closest(".ai-chat-clear-button")&&!a.target.closest(".ai-chat-clear-menu")&&Y(!1)};return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[te]);const Q=s=>re(null,null,function*(){const a=(s||he).trim();if(!a||x)return;const d=[/\[\[.*?ignore.*?\]\]/i,/\[\[.*?system.*?prompt.*?\]\]/i,/ignore\s+(previous|earlier|all|above|prior)\s+(instructions?|prompts?|rules?)/i,/(you\s+are\s+now|now\s+you\s+are|vocÃª\s+agora\s+Ã©)/i,/forget\s+(everything|all|previous)/i,/(esqueÃ§a|ignore)\s+(tudo|todas?|as\s+instruÃ§Ãµes)/i].some(i=>i.test(a));if(ue(""),W(!1),n(i=>[...i,{role:"user",content:a}]),T(""),d){n(i=>[...i,{role:"assistant",content:`Sou seu assistente de estudos da L2 EDUCA. Como posso ajudar com seus estudos?

[[FOLLOW_UP:Quero saber mais sobre as matÃ©rias disponÃ­veis]]`}]);return}if(!D){n(i=>[...i,{role:"assistant",content:"âš ï¸ **Chaves de API nÃ£o configuradas**\n\nPara ativar o assistente de estudos:\n\n**1.** Crie um arquivo `.env` na pasta `l2-educa/`\n\n**2.** Adicione sua chave:\n```\nVITE_OPENROUTER_API_KEY=sua-chave-aqui\nVITE_OPENROUTER_MODEL=deepseek/deepseek-chat-v3.1:free\n```\n\n**3.** Reinicie o servidor: `npm run dev`\n\nðŸ“š Veja `CHATBOT_SETUP.md` para instruÃ§Ãµes completas."}]);return}me(!0);const g=()=>re(null,null,function*(){var N,y,o,u,H,z,U;const i=_();if(i.push({role:"user",content:a}),((N=i[0])==null?void 0:N.role)==="system"&&console.log("ðŸ¤– System Prompt Preview:",i[0].content.substring(0,500)+"..."),p.backendUrl)try{const h=yield fetch(`${p.backendUrl}/api/chat/complete`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream"},body:JSON.stringify({messages:i,stream:!0})});if(h&&h.status===503)try{yield h.text()}catch(I){}else if(h&&h.ok&&h.body){const I=h.body.getReader(),E=new TextDecoder;let B="",V=!1;for(;;){const{value:L,done:$}=yield I.read();if($)break;const k=E.decode(L,{stream:!0}).split(`
`).filter(w=>w.trim().startsWith("data:"));for(const w of k)if(!w.includes("[DONE]"))try{const G=JSON.parse(w.replace("data: ","")),X=((u=(o=(y=G.choices)==null?void 0:y[0])==null?void 0:o.delta)==null?void 0:u.content)||G.content||"";if(X){B+=X,V||(V=!0,n(K=>[...K,{role:"assistant",content:""}]));const A=B.replace(/\[\]</g,"").replace(/\|\s*begin_of_sentence\s*\|\s*>/g,"").replace(/<\|.*?\|>/g,"").replace(/\[INST\].*?\[\/INST\]/g,"").replace(/<<SYS>>.*?<</g,"").replace(/\[\s*\]$/g,"").trim();n(K=>{const P=[...K];return P[P.length-1]={role:"assistant",content:A+"â–ˆ"},P})}}catch(G){}}if(V){const L=B.replace(/\[\]</g,"").replace(/\|\s*begin_of_sentence\s*\|\s*>/g,"").replace(/<\|.*?\|>/g,"").replace(/\[INST\].*?\[\/INST\]/g,"").replace(/<<SYS>>.*?<</g,"").replace(/\[\s*\]$/g,"").trim();n($=>{const S=[...$];return S.length&&S[S.length-1].role==="assistant"&&(S[S.length-1]={role:"assistant",content:L}),S});return}}}catch(h){console.warn("Backend proxy failed, falling back to client keys:",h)}const C=h=>new Promise(I=>setTimeout(I,h));let f=0;for(;;){const h=Le();if(h===-1){if(f++<20){yield C(1500);continue}throw new Error("no-available-keys")}const I=p.apiKeys[h];try{const E=yield fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${I}`,"Content-Type":"application/json",Accept:"text/event-stream","HTTP-Referer":`${window.location.protocol}//${window.location.host}`,"X-Title":"L2 EDUCA | Assistente Educacional"},body:JSON.stringify({model:p.model,messages:i,stream:!0})});if(!E.ok||!E.body){const k=E.status;k===401||k===403?R(h,J*5):k===429?R(h,Te):([500,502,503,504].includes(k),R(h,J)),Z.current=(h+1)%p.apiKeys.length;continue}Z.current=h;const B=E.body.getReader(),V=new TextDecoder;let L="",$=!1;for(;;){const{value:k,done:w}=yield B.read();if(w)break;const X=V.decode(k,{stream:!0}).split(`
`).filter(A=>A.trim().startsWith("data:"));for(const A of X)if(!A.includes("[DONE]"))try{const P=((U=(z=(H=JSON.parse(A.replace("data: ","")).choices)==null?void 0:H[0])==null?void 0:z.delta)==null?void 0:U.content)||"";if(P){L+=P,$||($=!0,n(oe=>[...oe,{role:"assistant",content:""}]));const _e=L.replace(/\[\]</g,"").replace(/\|\s*begin_of_sentence\s*\|\s*>/g,"").replace(/<\|.*?\|>/g,"").replace(/\[INST\].*?\[\/INST\]/g,"").replace(/<<SYS>>.*?<</g,"").replace(/\[\s*\]$/g,"").trim();n(oe=>{const ce=[...oe];return ce[ce.length-1]={role:"assistant",content:_e+"â–ˆ"},ce})}}catch(K){}}const S=L.replace(/\[\]</g,"").replace(/\|\s*begin_of_sentence\s*\|\s*>/g,"").replace(/<\|.*?\|>/g,"").replace(/\[INST\].*?\[\/INST\]/g,"").replace(/<<SYS>>.*?<</g,"").replace(/\[\s*\]$/g,"").trim();n(k=>{const w=[...k];return w.length&&w[w.length-1].role==="assistant"&&(w[w.length-1]={role:"assistant",content:S}),w});return}catch(E){R(h,J),Z.current=(h+1)%p.apiKeys.length;continue}}});try{yield g()}catch(i){console.error("API error:",i);let C="Estou com instabilidade no momento. Tente novamente em alguns instantes.";i.message==="no-available-keys"&&(C=`âš ï¸ **Erro de AutenticaÃ§Ã£o**

Suas chaves de API parecem estar **invÃ¡lidas ou expiradas**.

**SoluÃ§Ãµes:**

â€¢ Verifique se a chave estÃ¡ correta no arquivo \`.env\`
â€¢ Gere uma nova chave em [openrouter.ai/keys](https://openrouter.ai/keys)
â€¢ Reinicie o servidor apÃ³s alterar o \`.env\`

ðŸ’¡ **Dica:** Use o modelo gratuito \`deepseek/deepseek-chat-v3.1:free\` para testes!

ðŸ“š Consulte \`CHATBOT_SETUP.md\` para mais detalhes.`),n(f=>[...f,{role:"assistant",content:C}])}me(!1)});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"ai-chat-launcher",style:{bottom:"calc(1rem + var(--sticky-buybar-space, 0px))"},children:!c&&e.jsxs("button",{onClick:m,"aria-label":"Abrir assistente de estudos",className:"ai-chat-launcher-button",children:[e.jsx("div",{className:"ai-chat-launcher-bg"}),e.jsx("div",{className:"ai-chat-launcher-gloss"}),e.jsx("div",{className:"ai-chat-launcher-glow"}),e.jsx("div",{className:"ai-chat-launcher-shadow"}),e.jsxs("div",{className:"ai-chat-launcher-icon",children:[e.jsx(qe,{}),e.jsx("span",{className:"ai-chat-launcher-pulse"})]})]})}),(c||F)&&e.jsxs("div",{className:`ai-chat-window ${F?"closing":""}`,children:[e.jsx("div",{className:"ai-chat-glass-bg"}),e.jsx("div",{className:"ai-chat-noise"}),e.jsxs("div",{className:"ai-chat-container",children:[e.jsxs("div",{className:"ai-chat-header",children:[e.jsx("div",{className:"ai-chat-header-bg"}),e.jsxs("div",{className:"ai-chat-header-content",children:[e.jsxs("div",{className:"ai-chat-status",children:[e.jsx("div",{className:"ai-chat-status-dot"}),e.jsx("div",{className:"ai-chat-status-pulse"})]}),e.jsx("div",{className:"ai-chat-title",children:"Assistente de Estudos"})]}),e.jsxs("div",{className:"ai-chat-header-actions",children:[e.jsx("button",{"aria-label":"Limpar conversa",onClick:$e,className:"ai-chat-clear-button",children:e.jsx(De,{})}),te&&e.jsxs("div",{className:"ai-chat-clear-menu",children:[e.jsxs("button",{onClick:Ae,className:"ai-chat-clear-menu-item",children:[e.jsx("span",{className:"ai-chat-clear-menu-icon",children:"ðŸ—‘ï¸"}),e.jsx("span",{className:"ai-chat-clear-menu-text",children:"Limpar conversa atual"})]}),e.jsx("div",{className:"ai-chat-clear-menu-divider"}),e.jsxs("button",{onClick:Pe,className:"ai-chat-clear-menu-item ai-chat-clear-menu-item-danger",children:[e.jsx("span",{className:"ai-chat-clear-menu-icon",children:"ðŸ”¥"}),e.jsx("span",{className:"ai-chat-clear-menu-text",children:"Limpar todas as conversas"})]})]}),e.jsx("button",{"aria-label":"Fechar",onClick:ie,className:"ai-chat-close-button",children:e.jsx(We,{})})]})]}),e.jsx("div",{className:"ai-chat-messages-wrapper",children:e.jsx("div",{ref:j,className:"ai-chat-messages-scroll",children:e.jsx("div",{className:"ai-chat-messages-content",children:e.jsxs("div",{className:"ai-chat-messages-list",children:[t.map((s,a)=>{var f;const{html:l,tokens:d}=s.role==="assistant"?Me(s.content):{html:"",tokens:[]},g=x&&a===t.length-1&&s.role==="assistant"&&((f=s.content)==null?void 0:f.includes("â–ˆ")),i=a===Se;let C=l;return g&&(C=l.replace(/\u2588/g,'<span class="ai-chat-streaming-cursor"></span>')),e.jsxs(Oe.Fragment,{children:[e.jsx("div",{className:`ai-chat-message ${s.role==="user"?"user":"assistant"} ${g?"streaming":""} ${i?"completed":""}`,children:e.jsxs("div",{className:"ai-chat-message-bubble",children:[e.jsx("div",{className:"ai-chat-message-gloss"}),e.jsx("div",{className:"ai-chat-message-content",children:s.role==="assistant"?e.jsx("div",{dangerouslySetInnerHTML:{__html:C}}):s.content})]})}),s.role==="assistant"&&d&&d.length>0&&e.jsx("div",{className:"ai-chat-tokens",children:d.map((N,y)=>{if(N.type==="NAVIGATE"){const o=Ue(N.content);return e.jsxs("button",{onClick:()=>xe(o.path),className:"ai-chat-token-navigate",children:[e.jsx("div",{className:"ai-chat-token-bg"}),e.jsx("div",{className:"ai-chat-token-gloss"}),e.jsxs("div",{className:"ai-chat-token-content",children:[e.jsx("span",{className:"ai-chat-token-icon",children:ye(o.icon)}),e.jsx("span",{className:"ai-chat-token-label",children:o.label})]})]},y)}if(N.type==="TOPIC"){const o=Be(N.content);return o?e.jsxs("button",{onClick:()=>xe(o.path),className:"ai-chat-token-topic",style:{background:o.gradient},children:[e.jsx("div",{className:"ai-chat-token-gloss"}),e.jsxs("div",{className:"ai-chat-token-content",children:[e.jsx("span",{className:"ai-chat-token-icon",children:ye(o.icon)}),e.jsxs("div",{className:"ai-chat-token-topic-info",children:[e.jsx("div",{className:"ai-chat-token-topic-title",children:o.title}),e.jsxs("div",{className:"ai-chat-token-topic-meta",children:[o.difficulty&&e.jsx("span",{children:o.difficulty}),o.duration&&e.jsxs("span",{children:[" â€¢ ",o.duration]})]})]})]})]},y):null}return null})})]},a)}),x&&t.length>0&&!((we=(je=t[t.length-1])==null?void 0:je.content)!=null&&we.includes("â–ˆ"))&&e.jsx("div",{className:"ai-chat-message assistant",children:e.jsxs("div",{className:"ai-chat-typing-indicator",children:[e.jsx("div",{className:"ai-chat-typing-dot"}),e.jsx("div",{className:"ai-chat-typing-dot"}),e.jsx("div",{className:"ai-chat-typing-dot"})]})}),Ce&&t.length===1&&!x&&e.jsx("div",{className:"ai-chat-suggestions",children:Ee.map((s,a)=>e.jsxs("button",{onClick:()=>Q(s),className:"ai-chat-suggestion",children:[e.jsx("div",{className:"ai-chat-suggestion-bg"}),e.jsx("div",{className:"ai-chat-suggestion-gloss"}),e.jsxs("div",{className:"ai-chat-suggestion-content",children:[e.jsx("span",{className:"ai-chat-suggestion-text",children:s}),e.jsx(be,{className:"ai-chat-suggestion-icon"})]})]},a))}),se&&!x&&e.jsx("div",{className:"ai-chat-followup",children:e.jsxs("button",{onClick:()=>{const s=se;T(""),Q(s)},className:"ai-chat-suggestion",children:[e.jsx("div",{className:"ai-chat-suggestion-bg"}),e.jsx("div",{className:"ai-chat-suggestion-gloss"}),e.jsxs("div",{className:"ai-chat-suggestion-content",children:[e.jsx("span",{className:"ai-chat-suggestion-text",children:se}),e.jsx(be,{className:"ai-chat-suggestion-icon"})]})]})})]})})})}),e.jsxs("div",{className:"ai-chat-input-wrapper",children:[e.jsx("div",{className:"ai-chat-input-separator"}),e.jsx("div",{className:"ai-chat-input-container",children:e.jsxs("div",{className:"ai-chat-input-row",children:[e.jsxs("div",{className:"ai-chat-textarea-wrapper",children:[e.jsx("textarea",{className:"ai-chat-textarea",placeholder:D?"Pergunte sobre qualquer matÃ©ria...":"Configure as chaves de API",value:he,onChange:s=>ue(s.target.value),onInput:s=>{const a=s.currentTarget;a.style.height="auto",a.style.height=Math.min(140,a.scrollHeight)+"px"},onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),Q())},disabled:x}),e.jsx("div",{className:"ai-chat-textarea-glow"})]}),e.jsxs("button",{type:"button",onClick:()=>Q(),disabled:x||!D,"aria-label":"Enviar mensagem",className:`ai-chat-send-button ${x||!D?"disabled":""}`,children:[e.jsx("div",{className:"ai-chat-send-bg"}),e.jsx("div",{className:"ai-chat-send-gloss"}),e.jsx("div",{className:"ai-chat-send-glow"}),e.jsx("div",{className:"ai-chat-send-icon",children:e.jsx(Fe,{className:x?"pulsing":""})})]})]})})]})]})]})]})}export{rs as AIChatWidget,rs as default};
