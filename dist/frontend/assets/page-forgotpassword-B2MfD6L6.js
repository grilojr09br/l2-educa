var q=Object.defineProperty,X=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var M=(t,e,s)=>e in t?q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,P=(t,e)=>{for(var s in e||(e={}))Y.call(e,s)&&M(t,s,e[s]);if(T)for(var s of T(e))Z.call(e,s)&&M(t,s,e[s]);return t},O=(t,e)=>X(t,B(e));var g=(t,e,s)=>new Promise((c,u)=>{var n=h=>{try{p(s.next(h))}catch(v){u(v)}},l=h=>{try{p(s.throw(h))}catch(v){u(v)}},p=h=>h.done?c(h.value):Promise.resolve(h.value).then(n,l);p((s=s.apply(t,e)).next())});import{r as d,j as o,b as G,L as D}from"./react-vendor-DYggY1V5.js";import{c as K,a as Q,o as H,s as W}from"./vendor-IcH3LwkJ.js";/* empty css                       */const ee="https://usyqgsgdsppthjmvyjxf.supabase.co",re="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVzeXFnc2dkc3BwdGhqbXZ5anhmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzODgzOTgsImV4cCI6MjA3Nzk2NDM5OH0.A9QBFHK3EJFuXXUtQSSoDTiIp2opr0xtoLVA__JEpfc",b=K(ee,re,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),_="l2educa_rate_limit",A="l2educa_last_activity",te=1440*60*1e3,pe=(t="global")=>{const e=`${_}_${t}`,s=localStorage.getItem(e);if(!s)return{allowed:!0,remainingAttempts:5,resetTime:null};try{const{attempts:c,timestamp:u}=JSON.parse(s),n=Date.now(),l=600*1e3;if(n-u>l)return localStorage.removeItem(e),{allowed:!0,remainingAttempts:5,resetTime:null};if(c>=5){const p=u+l,h=Math.ceil((p-n)/6e4);return{allowed:!1,remainingAttempts:0,resetTime:p,minutesLeft:h}}return{allowed:!0,remainingAttempts:5-c,resetTime:null}}catch(c){return console.error("Rate limit check error:",c),localStorage.removeItem(e),{allowed:!0,remainingAttempts:5,resetTime:null}}},we=(t="global")=>{const e=`${_}_${t}`,s=localStorage.getItem(e);try{if(!s){localStorage.setItem(e,JSON.stringify({attempts:1,timestamp:Date.now()}));return}const{attempts:c,timestamp:u}=JSON.parse(s),n=Date.now(),l=600*1e3;if(n-u>l){localStorage.setItem(e,JSON.stringify({attempts:1,timestamp:n}));return}localStorage.setItem(e,JSON.stringify({attempts:c+1,timestamp:u}))}catch(c){console.error("Record failed attempt error:",c)}},se=(t="global")=>{const e=`${_}_${t}`;localStorage.removeItem(e)},I=()=>{localStorage.setItem(A,Date.now().toString())},oe=()=>{const t=localStorage.getItem(A);if(!t)return I(),!1;const e=Date.now(),s=parseInt(t,10);return e-s>te},N=()=>{localStorage.removeItem(A)},ae=t=>{const e=["mousedown","keydown","scroll","touchstart","click"],s=()=>{I()};e.forEach(u=>{document.addEventListener(u,s,{passive:!0})});const c=setInterval(()=>{oe()&&t()},6e4);return()=>{e.forEach(u=>{document.removeEventListener(u,s)}),clearInterval(c)}},be=t=>{if(!t)return{score:0,label:"Muito fraca",color:"#ef4444"};let e=0;return t.length>=8&&(e+=1),t.length>=12&&(e+=1),t.length>=16&&(e+=1),/[a-z]/.test(t)&&(e+=1),/[A-Z]/.test(t)&&(e+=1),/[0-9]/.test(t)&&(e+=1),/[!@#$%^&*(),.?":{}|<>]/.test(t)&&(e+=1),/(.)\1{2,}/.test(t)&&(e-=1),/(?:abc|bcd|cde|def|efg|fgh|ghi|hij|ijk|jkl|klm|lmn|mno|nop|opq|pqr|qrs|rst|stu|tuv|uvw|vwx|wxy|xyz|012|123|234|345|456|567|678|789)/i.test(t)&&(e-=1),e=Math.max(0,Math.min(10,e)),e<=3?{score:e,label:"Fraca",color:"#ef4444"}:e<=6?{score:e,label:"MÃ©dia",color:"#f59e0b"}:e<=8?{score:e,label:"Forte",color:"#10b981"}:{score:e,label:"Muito forte",color:"#059669"}},F=d.createContext(void 0),ve=({children:t})=>{const[e,s]=d.useState(null),[c,u]=d.useState(!0),[n,l]=d.useState(null),[p,h]=d.useState(!1),v=d.useCallback(()=>g(null,null,function*(){console.log("â±ï¸ Session timeout - logging out");try{yield k()}catch(r){console.error("Timeout logout error:",r)}}),[]),x=d.useCallback(r=>g(null,null,function*(){try{const{data:a,error:E}=yield b.from("users").select("id, email, username, created_at, avatar_url").eq("id",r).single();return!E&&a?a:null}catch(a){return console.error("Error fetching user data:",a),null}}),[]);d.useEffect(()=>{let r=!0;g(null,null,function*(){var f,m,w;if(r)try{console.log("ðŸ” Initial session check...");const{data:{session:i},error:L}=yield b.auth.getSession();if(!r)return;if(L){console.error("âŒ Session error:",L),l(null),s(null),u(!1),h(!0);return}if(console.log("ðŸ“¦ Session found:",{hasSession:!!i,email:(f=i==null?void 0:i.user)==null?void 0:f.email,emailConfirmed:!!((m=i==null?void 0:i.user)!=null&&m.email_confirmed_at)}),l(i),i!=null&&i.user){const z=yield x(i.user.id);if(!r)return;s(z||{id:i.user.id,email:i.user.email,username:((w=i.user.email)==null?void 0:w.split("@")[0])||"user",created_at:i.user.created_at,avatar_url:null}),I()}else s(null)}catch(i){console.error("âŒ Error checking session:",i),r&&(l(null),s(null))}finally{r&&(u(!1),h(!0))}});const{data:{subscription:E}}=b.auth.onAuthStateChange((f,m)=>g(null,null,function*(){var w;if(!(!r||!p))if(console.log("ðŸ” Auth state changed:",f),l(m),m!=null&&m.user){const i=yield x(m.user.id);r&&(s(i||{id:m.user.id,email:m.user.email,username:((w=m.user.email)==null?void 0:w.split("@")[0])||"user",created_at:m.user.created_at,avatar_url:null}),f==="SIGNED_IN"&&I())}else r&&(s(null),N())})),y=ae(v);return()=>{r=!1,E==null||E.unsubscribe(),y()}},[v,x,p]);const j=(r,a,E)=>g(null,null,function*(){var y;try{const{data:f,error:m}=yield b.auth.signUp({email:r,password:a,options:{data:{username:E},emailRedirectTo:`${window.location.origin}/#/verify-email`}});if(m)throw(y=m.message)!=null&&y.includes("already registered")?new Error("Este email jÃ¡ estÃ¡ cadastrado"):m;if(!f.user)throw new Error("Falha no registro");return{success:!0,user:f.user,requiresEmailVerification:!0}}catch(f){throw console.error("âŒ Registration error:",f),f}}),S=(r,a)=>g(null,null,function*(){var E,y,f,m;try{const{data:w,error:i}=yield b.auth.signInWithPassword({email:r,password:a});if(i)throw(E=i.message)!=null&&E.includes("Invalid login credentials")?new Error("Email ou senha incorretos"):(y=i.message)!=null&&y.includes("Email not confirmed")?new Error("EMAIL_NOT_CONFIRMED"):(f=i.message)!=null&&f.includes("network")?new Error("Erro de conexÃ£o. Verifique sua internet."):i;if(!w.session)throw new Error("Erro ao criar sessÃ£o");return se(r),I(),{success:!0,user:w.user,session:w.session,emailVerified:!!((m=w.session.user)!=null&&m.email_confirmed_at)}}catch(w){throw console.error("âŒ Login error:",w),w}}),k=()=>g(null,null,function*(){try{console.log("ðŸšª Iniciando logout...");const{error:r}=yield b.auth.signOut({scope:"global"});if(r)throw r;return s(null),l(null),N(),localStorage.removeItem("l2educa_last_activity"),sessionStorage.clear(),console.log("âœ… Logout completo!"),{success:!0}}catch(r){throw console.error("âŒ Logout error:",r),s(null),l(null),N(),r}}),C=r=>g(null,null,function*(){try{const{error:a}=yield b.auth.resetPasswordForEmail(r,{redirectTo:`${window.location.origin}/reset-password`});if(a)throw a;return{success:!0}}catch(a){throw console.error("Password reset error:",a),a}}),R=r=>g(null,null,function*(){try{const{error:a}=yield b.auth.updateUser({password:r});if(a)throw a;return{success:!0}}catch(a){throw console.error("Update password error:",a),a}}),U=r=>g(null,null,function*(){try{if(!e)throw new Error("UsuÃ¡rio nÃ£o autenticado");const{error:a}=yield b.from("user_profiles").update(r).eq("user_id",e.id);if(a)throw a;return{success:!0}}catch(a){throw console.error("Update profile error:",a),a}}),J=()=>g(null,null,function*(){try{if(!e)throw new Error("UsuÃ¡rio nÃ£o autenticado");const{data:r,error:a}=yield b.from("user_profiles").select("*").eq("user_id",e.id).single();if(a)throw a;return r}catch(r){throw console.error("Get profile error:",r),r}}),V=()=>g(null,null,function*(){try{if(!(e!=null&&e.email))throw new Error("Email nÃ£o encontrado");const{error:r}=yield b.auth.resend({type:"signup",email:e.email,options:{emailRedirectTo:`${window.location.origin}/#/verify-email`}});if(r)throw r;return{success:!0}}catch(r){throw console.error("âŒ Resend verification error:",r),r}}),$={user:e,session:n,loading:c,isAuthenticated:!!e,isEmailVerified:(()=>{var r;return((r=n==null?void 0:n.user)==null?void 0:r.email_confirmed_at)!=null})(),register:j,login:S,logout:k,resetPassword:C,updatePassword:R,updateProfile:U,getUserProfile:J,resendVerificationEmail:V};return o.jsx(F.Provider,{value:$,children:t})},ie=()=>{const t=d.useContext(F);if(!t)throw new Error("useAuth deve ser usado dentro de AuthProvider");return t},ne=()=>{const t=d.useRef(null),[e,s]=d.useState(!1),[c,u]=d.useState(!1);return d.useEffect(()=>{const n=()=>{const l=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768;s(l)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),d.useEffect(()=>{if(e)return;const n=t.current;if(!n)return;const l=new IntersectionObserver(p=>{p.forEach(h=>{u(!h.isIntersecting)})},{threshold:.1,rootMargin:"100px"});return l.observe(n),()=>{l&&l.disconnect()}},[e]),o.jsxs("div",{ref:t,className:`aurora-background ${e?"mobile-static":""} ${c?"paused":""}`,children:[o.jsx("div",{className:"aurora-blob aurora-blob-1"}),o.jsx("div",{className:"aurora-blob aurora-blob-2"}),o.jsx("div",{className:"aurora-blob aurora-blob-3"}),o.jsx("div",{className:"aurora-blob aurora-blob-4"})]})},le=H({email:W().email("Email invÃ¡lido").min(1,"Email Ã© obrigatÃ³rio")}),ce=()=>{const{resetPassword:t}=ie(),[e,s]=d.useState(null),[c,u]=d.useState(!1),[n,l]=d.useState(!1),{register:p,handleSubmit:h,formState:{errors:v}}=G({resolver:Q(le)}),x=j=>g(null,null,function*(){s(null),u(!0);try{yield t(j.email),l(!0)}catch(S){s(S.message||"Erro ao solicitar recuperaÃ§Ã£o de senha")}finally{u(!1)}});return n?o.jsx("div",{className:"auth-form-container",children:o.jsxs("div",{className:"success-message",children:[o.jsx("div",{className:"success-icon",children:"âœ“"}),o.jsx("h2",{children:"Email enviado!"}),o.jsx("p",{children:"Se o email existir em nossa base, vocÃª receberÃ¡ instruÃ§Ãµes para redefinir sua senha."}),o.jsx(D,{to:"/login",className:"link-button",children:"Voltar para o login"})]})}):o.jsxs("div",{className:"auth-form-container",children:[o.jsxs("div",{className:"auth-form-header",children:[o.jsx("h2",{className:"auth-form-title",children:"Recuperar senha"}),o.jsx("p",{className:"auth-form-subtitle",children:"Digite seu email para receber um link de recuperaÃ§Ã£o"})]}),o.jsxs("form",{onSubmit:h(x),className:"auth-form",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"email",className:"form-label",children:"Email"}),o.jsx("input",O(P({id:"email",type:"email"},p("email")),{disabled:c,className:`form-input ${v.email?"form-input-error":""}`,placeholder:"seu@email.com"})),v.email&&o.jsx("span",{className:"form-error",children:v.email.message})]}),e&&o.jsx("div",{className:"api-error",children:e}),o.jsx("button",{type:"submit",disabled:c,className:"submit-button",children:c?o.jsxs("span",{className:"button-loading",children:[o.jsx("span",{className:"spinner"}),"Enviando..."]}):"Enviar link de recuperaÃ§Ã£o"}),o.jsx("div",{className:"form-footer",children:o.jsxs("p",{className:"footer-text",children:["Lembrou sua senha?"," ",o.jsx(D,{to:"/login",className:"link-text",children:"Voltar para o login"})]})})]})]})},ue=()=>o.jsxs("div",{className:"auth-page",children:[o.jsx(ne,{}),o.jsxs("div",{className:"auth-page-content",children:[o.jsxs("div",{className:"auth-page-logo",children:[o.jsx("h1",{className:"logo-text",children:"L2 EDUCA"}),o.jsx("p",{className:"logo-subtitle",children:"Plataforma Educacional"})]}),o.jsx("div",{className:"auth-card",children:o.jsx(ce,{})})]})]}),Ee=Object.freeze(Object.defineProperty({__proto__:null,default:ue},Symbol.toStringTag,{value:"Module"}));export{ne as A,Ee as F,be as a,ve as b,pe as c,we as r,b as s,ie as u};
