var C=Object.defineProperty,F=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var P=(i,a,s)=>a in i?C(i,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[a]=s,N=(i,a)=>{for(var s in a||(a={}))z.call(a,s)&&P(i,s,a[s]);if(A)for(var s of A(a))T.call(a,s)&&P(i,s,a[s]);return i},E=(i,a)=>F(i,M(a));var w=(i,a,s)=>new Promise((f,o)=>{var n=l=>{try{t(s.next(l))}catch(u){o(u)}},g=l=>{try{t(s.throw(l))}catch(u){o(u)}},t=l=>l.done?f(l.value):Promise.resolve(l.value).then(n,g);t((s=s.apply(i,a)).next())});import{u as _,a as D,r as d,b as $,j as e,L as R}from"./react-vendor-DYggY1V5.js";import{a as B,o as O,s as k}from"./vendor-IcH3LwkJ.js";import{u as y,c as b,r as U,A as G}from"./page-forgotpassword-B2MfD6L6.js";/* empty css                       */const H=O({email:k().email("Email inv√°lido").min(1,"Email √© obrigat√≥rio"),password:k().min(1,"Senha √© obrigat√≥ria")}),J=()=>{const{login:i}=y(),a=_(),s=D(),[f,o]=d.useState(null),[n,g]=d.useState(!1),[t,l]=d.useState({allowed:!0,minutesLeft:0}),{register:u,handleSubmit:x,formState:{errors:r},watch:h}=$({resolver:B(H)}),j=h("email");d.useEffect(()=>{if(j){const m=b(j);l(m)}},[j]);const q=m=>w(null,null,function*(){var L,V,I;const S=b(m.email);if(!S.allowed){o(`Muitas tentativas. Aguarde ${S.minutesLeft} minutos.`);return}o(null),g(!0);try{console.log("üîê Attempting login...");const c=yield i(m.email,m.password);if(console.log("‚úÖ Login successful:",c),!c.emailVerified){console.log("‚ö†Ô∏è Email not verified"),o("Por favor, verifique seu email antes de fazer login. Verifique sua caixa de entrada."),localStorage.setItem("emailVerificationPending","true"),localStorage.setItem("emailVerificationEmail",m.email),g(!1);return}localStorage.removeItem("emailVerificationPending"),localStorage.removeItem("emailVerificationEmail"),yield new Promise(v=>setTimeout(v,300));const p=((V=(L=s.state)==null?void 0:L.from)==null?void 0:V.pathname)||"/";console.log("üöÄ Redirecting to:",p),a(p,{replace:!0})}catch(c){if(console.error("‚ùå Login error:",c),U(m.email),c.message==="EMAIL_NOT_CONFIRMED")o("Por favor, verifique seu email antes de fazer login. Verifique sua caixa de entrada."),localStorage.setItem("emailVerificationPending","true"),localStorage.setItem("emailVerificationEmail",m.email);else{const v=c.message==="Email ou senha incorretos"||(I=c.message)!=null&&I.includes("conex√£o")?c.message:c.message||"Erro ao fazer login";o(v)}const p=b(m.email);l(p)}finally{g(!1)}});return e.jsxs("div",{className:"auth-form-container",children:[e.jsxs("div",{className:"auth-form-header",children:[e.jsx("h2",{className:"auth-form-title",children:"Bem-vindo de volta"}),e.jsx("p",{className:"auth-form-subtitle",children:"Entre com sua conta para continuar"})]}),e.jsxs("form",{onSubmit:x(q),className:"auth-form",children:[!t.allowed&&e.jsxs("div",{className:"rate-limit-warning",children:["üîí Muitas tentativas de login. Aguarde ",t.minutesLeft," minuto(s) antes de tentar novamente."]}),t.allowed&&t.remainingAttempts<=2&&t.remainingAttempts>0&&e.jsxs("div",{className:"rate-limit-info",children:["‚ö†Ô∏è ",t.remainingAttempts," tentativa(s) restante(s)"]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:"Email"}),e.jsx("input",E(N({id:"email",type:"email"},u("email")),{disabled:n||!t.allowed,className:`form-input ${r.email?"form-input-error":""}`,placeholder:"seu@email.com",autoComplete:"email"})),r.email&&e.jsx("span",{className:"form-error",children:r.email.message})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",className:"form-label",children:"Senha"}),e.jsx("input",E(N({id:"password",type:"password"},u("password")),{disabled:n||!t.allowed,className:`form-input ${r.password?"form-input-error":""}`,placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",autoComplete:"current-password"})),r.password&&e.jsx("span",{className:"form-error",children:r.password.message})]}),e.jsx("div",{className:"form-footer-link",children:e.jsx(R,{to:"/forgot-password",className:"link-text",children:"Esqueceu sua senha?"})}),f&&e.jsx("div",{className:"api-error",children:f}),e.jsx("button",{type:"submit",disabled:n||!t.allowed,className:"submit-button",children:n?e.jsxs("span",{className:"button-loading",children:[e.jsx("span",{className:"spinner"}),"Entrando..."]}):"Entrar"}),e.jsx("div",{className:"form-footer",children:e.jsxs("p",{className:"footer-text",children:["N√£o tem uma conta?"," ",e.jsx(R,{to:"/register",className:"link-text",children:"Cadastre-se"})]})})]})]})},K=()=>{const[i,a]=d.useState(!1),[s,f]=d.useState(!1),[o,n]=d.useState(!1),[g,t]=d.useState(""),{resendVerificationEmail:l}=y();d.useEffect(()=>{const r=localStorage.getItem("emailVerificationPending"),h=localStorage.getItem("emailVerificationEmail");r==="true"&&h&&(a(!0),t(h))},[]);const u=()=>{localStorage.removeItem("emailVerificationPending"),localStorage.removeItem("emailVerificationEmail"),a(!1)},x=()=>w(null,null,function*(){f(!0),n(!1);try{yield new Promise(r=>setTimeout(r,1e3)),n(!0),setTimeout(()=>{n(!1)},3e3)}catch(r){console.error("Error resending verification email:",r)}finally{f(!1)}});return i?e.jsx("div",{className:"email-verification-notice",children:e.jsxs("div",{className:"notice-content",children:[e.jsx("div",{className:"notice-icon",children:e.jsx("span",{className:"material-icons",children:"mark_email_unread"})}),e.jsxs("div",{className:"notice-text",children:[e.jsx("h3",{className:"notice-title",children:"Verifique seu email"}),e.jsxs("p",{className:"notice-message",children:["Enviamos um link de verifica√ß√£o para ",e.jsx("strong",{children:g}),".",e.jsx("br",{}),"Por favor, verifique seu email antes de fazer login."]}),o&&e.jsx("p",{className:"resend-success",children:"‚úì Email de verifica√ß√£o reenviado com sucesso!"})]}),e.jsxs("div",{className:"notice-actions",children:[e.jsx("button",{onClick:x,disabled:s||o,className:"btn-resend",children:s?"Reenviando...":"Reenviar email"}),e.jsx("button",{onClick:u,className:"btn-dismiss",children:e.jsx("span",{className:"material-icons",children:"close"})})]})]})}):null},ee=()=>e.jsxs("div",{className:"auth-page",children:[e.jsx(G,{}),e.jsxs("div",{className:"auth-page-content",children:[e.jsxs("div",{className:"auth-page-logo",children:[e.jsx("h1",{className:"logo-text",children:"L2 EDUCA"}),e.jsx("p",{className:"logo-subtitle",children:"Plataforma Educacional"})]}),e.jsxs("div",{className:"auth-card",children:[e.jsx(K,{}),e.jsx(J,{})]})]})]});export{ee as default};
